
# 基于区块链的认证方案

## 概述

随着社会的发展和技术的进步，人们对隐私的重视程度越来越高。随着互联化程度越来越高，黑客盗取资产的事件越来越多，人们对安全的渴求越来越高，各行各业在安全方面的资源投入与日俱增。为了兼顾产品的用户体验和安全性使得越来越多的公司选择使用短信验证来做更多的场景。例如登录、支付前验证等等，随着互联网的普及带宽成本越来越低，短信的成本成为了企业的一项重要开支。为了降低企业成本并且兼具用户体验，微令牌开创性的设计出了一套方案使得企业的验证成本降低到接近零。同时在安全性、易用性、隐私性上几乎可以媲美短信验证。

微令牌是客户端和服务端验证方案。包括自助研发的一套基于RSA的离线验证方案。为了使工具有更多的适用性，同时也支持原有被广泛使用的离线验证方案和各种网站、App密码的安全存储和获取。用户使用的密码或者Key加密后存储到区块链上保证安全和隐私。



## 背景

### 区块链

2008年11月1日，中本聪(Satoshi Nakamoto)在一个隐秘的密码学讨论组上贴出了一篇研究报告，报告阐述了他对电子货币的新构想——比特币就此问世！

至此10年时间比特币经历了前所未有的发展，随着比特币市值不断突破新高，各种争议不断，但是比特币使用的区块链技术成为了一种炙手可热的技术，去中心化思想、不可篡改性带了更多的机遇和可能性，同时比特币在这十年间的发展同时也验证了区块链的安全性，目前为止没有报道过比特币私钥被盗的情况，这也为在区块链上存储隐私的数据提供了重要的参考依据。

同时区块链的隐私机制使得只有持有密钥的人才能使用存储在区块链的资产，其实用户自己数据才是最宝贵的资产，尤其是用户的密码和私钥等信息更为重要。



### 短信验证
自从微信等应用的发展和普及，短信在用户端市场逐渐萎缩，但是短信的作用在企业级市场越来越重要。据统计由几年前移动用户主动发起的点对点短信和企业短信各自占据移动短信业务量的半壁江山；而今，这两部分占比已成二八分化的格局。

短信业务量略现降幅，企业短信持续增长近日，工信部发布《2017年通信业统计公报》，报告披露，2017年全国移动短信业务量6644亿条，比上年减少0.4%。其中，由移动用户主动发起的点对点短信量比上年减少30.2%，为1322.22亿条，占移动短信业务量比重由上年的28.5%降至19.9%。根据此组数据和以往数据推算，2017年企业短信发送量达5322.11亿条，比上年增长11.42%。从2012年起，全国移动短信业务量呈现逐年下降趋势，其中由移动用户主动发起的点对点短信量下滑明显。几年间，点对点短信已从年发送量约5000亿条降至不足1500亿条，缩水率超过70%。与此同时，在经历了2014年的市场调整之后，企业短信逆势增长，并在2016-2017连续两年增幅超过11.4%。

假如按照0.1元一条的成本计算，2017年的企业在短信领域支出已经超过400亿元，按照2015年-2016年，2016年-2017年的大约11%的增速和企业的占比增速，2018年企业级可能超过500亿人民币。 短信的支出已然是企业的重大成本支出。

为什么企业使用短信验证呢？

短信具有第二次验证的作用，也就是除了用户的密码外，另外一次独立验证
门槛低 只要用户有一台能接受信息的手机就可以验证
安全性高 每隔很短的时间验证码就会失效，使被破解的概率大大降低
短信验证也不是没有缺陷，短信的缺点有几个

随着业务的国际化，成本越来越高
短信下发不稳定 很高的收不到的概率
短信存在中间人被攻击的可能，伪基站等风险
目前也有其他的二次身份认证方案，例如TOTP基于时间的一次性密码算法


该方案的优点

成本非常低，即使是跨地域
足够的安全性
该方案的缺点

使用对称加密，服务器有泄露Key的风险
一般需要安装App
需要记住每个网站、App的Key
WeiToken的方案

该方案采用用RSA非对称加密方案，实现用户认证

该方案包括了所有TOTP的优点，并且解决了如下问题

使用非对称加密，服务端只有用户的公钥
不需要用户记住网站的密码，密码是每次动态生成的
使用分层确定技术可以让用户只用记住一个私钥，生成每个网站对应的公、私钥对，每个公、私钥对互不可见
使用助记词让私钥可以更易记忆，进一步做变体可以使得像常规密码易用
该方案的缺点是需要安装App，但是随着智能手机的普及这个问题似乎越来越不重要。



## 方案规划(草案)

WeiToken整个方案主要包括几部分，协议定义、业务流程定义、架构实现。目前的版本是草案后续会进行更新

### 协议定义：
WeiToken协议定义为uri格式
weitoken://${action}?${params}


标识	           描述	            备注     
weitoken://	    协议的标识	
action	        当前要执行的动作	  request 、login、update、register
params	        当前动作的参数	


### action说明：

#### requestCode：服务端返回的加密后的动态密码
params：使用公钥加密后的数据：包括（issur，public_code）
例如：weitoken://requestCode?xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx


#### login：执行登录动作
params：解密服务端返回的动态密码和签名
例如：weitoken://login?XEf0BE

#### update: 更新公钥
params：登录码:公钥:sign(登录名)
例如：weitoken://update?password:pub_key:sign(issur:login_name)

#### register：注册新网站
params：根据公钥生成的锁码(public_key+publick_code)
weitoken://update?password:lock_code


## 项目架构
WeiToken会开发IOS、Android、Windows、Mac、小程序等客户端。
WeiToken服务端会开发nodejs、java、go、php、python等库方便服务端接入
